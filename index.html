<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Waheed Fragrance</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Georgia', serif;
    }

    * {
      box-sizing: border-box;
    }

    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .hover-lift {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .hover-lift:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
    }

    .nav-link {
      transition: color 0.3s ease;
    }

    .filter-btn {
      transition: all 0.3s ease;
    }

    .modal-backdrop {
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
    }
  </style>
  <style>
    @view-transition {
      navigation: auto;
    }
  </style>
</head>

<body class="w-full min-h-full">
  <div id="app" class="w-full min-h-full"></div>
  <script>
    const defaultConfig = {
      background_color: "#f8f7f4",
      surface_color: "#ffffff",
      text_color: "#2d2d2d",
      primary_action_color: "#c9a961",
      secondary_action_color: "#8b7355",
      font_family: "Georgia",
      font_size: 16,
      store_name: "Essence Luxe",
      store_tagline: "Discover Your Signature Scent",
      whatsapp_number: "+1234567890",
      instagram_handle: "@essenceluxe",
      about_text: "We curate the finest collection of luxury perfumes from around the world. Each fragrance tells a story, crafted with passion and elegance.",
      hero_heading: "Unveil Your Essence"
    };

    let allPerfumes = [];
    let currentView = 'home';
    let selectedCategory = 'all';
    let searchQuery = '';
    let selectedPerfume = null;
    let isAdmin = false;

    const dataHandler = {
      onDataChanged(data) {
        allPerfumes = data;
        renderApp();
      }
    };

    async function initializeApp() {
      const initResult = await window.dataSdk.init(dataHandler);
      if (!initResult.isOk) {
        console.error("Failed to initialize data SDK");
        return;
      }

      window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (config) => {
          renderApp();
        },
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (value) => {
                config.background_color = value;
                window.elementSdk.setConfig({ background_color: value });
              }
            },
            {
              get: () => config.surface_color || defaultConfig.surface_color,
              set: (value) => {
                config.surface_color = value;
                window.elementSdk.setConfig({ surface_color: value });
              }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => {
                config.text_color = value;
                window.elementSdk.setConfig({ text_color: value });
              }
            },
            {
              get: () => config.primary_action_color || defaultConfig.primary_action_color,
              set: (value) => {
                config.primary_action_color = value;
                window.elementSdk.setConfig({ primary_action_color: value });
              }
            },
            {
              get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
              set: (value) => {
                config.secondary_action_color = value;
                window.elementSdk.setConfig({ secondary_action_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || defaultConfig.font_family,
            set: (value) => {
              config.font_family = value;
              window.elementSdk.setConfig({ font_family: value });
            }
          },
          fontSizeable: {
            get: () => config.font_size || defaultConfig.font_size,
            set: (value) => {
              config.font_size = value;
              window.elementSdk.setConfig({ font_size: value });
            }
          }
        }),
        mapToEditPanelValues: (config) => new Map([
          ["store_name", config.store_name || defaultConfig.store_name],
          ["store_tagline", config.store_tagline || defaultConfig.store_tagline],
          ["whatsapp_number", config.whatsapp_number || defaultConfig.whatsapp_number],
          ["instagram_handle", config.instagram_handle || defaultConfig.instagram_handle],
          ["about_text", config.about_text || defaultConfig.about_text],
          ["hero_heading", config.hero_heading || defaultConfig.hero_heading]
        ])
      });

      renderApp();
    }

    function renderApp() {
      const config = window.elementSdk?.config || defaultConfig;
      const app = document.getElementById('app');

      const bgColor = config.background_color || defaultConfig.background_color;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
      const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;
      const fontFamily = config.font_family || defaultConfig.font_family;
      const baseFontSize = config.font_size || defaultConfig.font_size;

      app.style.fontFamily = `${fontFamily}, serif`;
      app.style.backgroundColor = bgColor;
      app.style.color = textColor;

      let content = '';

      if (currentView === 'home') {
        content = renderHome(config, bgColor, surfaceColor, textColor, primaryColor, secondaryColor, baseFontSize);
      } else if (currentView === 'catalog') {
        content = renderCatalog(config, bgColor, surfaceColor, textColor, primaryColor, secondaryColor, baseFontSize);
      } else if (currentView === 'about') {
        content = renderAbout(config, bgColor, surfaceColor, textColor, primaryColor, secondaryColor, baseFontSize);
      } else if (currentView === 'contact') {
        content = renderContact(config, bgColor, surfaceColor, textColor, primaryColor, secondaryColor, baseFontSize);
      } else if (currentView === 'admin') {
        content = renderAdmin(config, bgColor, surfaceColor, textColor, primaryColor, secondaryColor, baseFontSize);
      }

      app.innerHTML = content;
      attachEventListeners(config, primaryColor, secondaryColor);
    }

    function renderHome(config, bgColor, surfaceColor, textColor, primaryColor, secondaryColor, baseFontSize) {
      const storeName = config.store_name || defaultConfig.store_name;
      const storeTagline = config.store_tagline || defaultConfig.store_tagline;
      const heroHeading = config.hero_heading || defaultConfig.hero_heading;
      const featuredPerfumes = allPerfumes.filter(p => p.featured).slice(0, 3);

      return `
        ${renderNav(storeName, surfaceColor, textColor, secondaryColor, baseFontSize)}
        
        <header class="w-full text-center py-32" style="background: linear-gradient(135deg, ${primaryColor} 0%, ${secondaryColor} 100%); color: white;">
          <h1 class="mb-4" style="font-size: ${baseFontSize * 3}px; font-weight: 300; letter-spacing: 4px;">${heroHeading}</h1>
          <p class="mb-8" style="font-size: ${baseFontSize * 1.25}px; opacity: 0.95;">${storeTagline}</p>
          <button onclick="navigateToView('catalog')" class="px-8 py-3 border-2 border-white hover:bg-white transition-all duration-300" style="font-size: ${baseFontSize}px; color: white; cursor: pointer;" onmouseover="this.style.color='${textColor}'" onmouseout="this.style.color='white'">
            Explore Collection
          </button>
        </header>
        
        <main class="w-full max-w-6xl mx-auto px-6 py-16">
          ${featuredPerfumes.length > 0 ? `
            <section class="mb-16">
              <h2 class="text-center mb-12" style="font-size: ${baseFontSize * 2}px; font-weight: 300; letter-spacing: 2px; color: ${textColor};">Featured Fragrances</h2>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                ${featuredPerfumes.map(p => renderPerfumeCard(p, surfaceColor, textColor, primaryColor, baseFontSize)).join('')}
              </div>
            </section>
          ` : `
            <section class="text-center py-16">
              <p style="font-size: ${baseFontSize * 1.25}px; color: ${textColor}; opacity: 0.7;">No featured products yet. Add perfumes from the admin panel.</p>
              <button onclick="navigateToView('admin')" class="mt-6 px-6 py-2 text-white" style="background-color: ${primaryColor}; font-size: ${baseFontSize}px; cursor: pointer;">
                Go to Admin Panel
              </button>
            </section>
          `}
          
          <section class="text-center py-16" style="background-color: ${surfaceColor}; border-radius: 8px;">
            <h2 class="mb-4" style="font-size: ${baseFontSize * 1.75}px; font-weight: 300; color: ${textColor};">Experience Luxury</h2>
            <p class="mb-8 max-w-2xl mx-auto" style="font-size: ${baseFontSize}px; color: ${textColor}; opacity: 0.8; line-height: 1.8;">
              ${config.about_text || defaultConfig.about_text}
            </p>
            <button onclick="navigateToView('about')" class="px-6 py-2" style="background-color: ${secondaryColor}; color: white; font-size: ${baseFontSize}px; cursor: pointer;">
              Learn More
            </button>
          </section>
        </main>
        
        ${renderFooter(config, surfaceColor, textColor, primaryColor, baseFontSize)}
      `;
    }

    function renderCatalog(config, bgColor, surfaceColor, textColor, primaryColor, secondaryColor, baseFontSize) {
      const storeName = config.store_name || defaultConfig.store_name;
      const categories = ['all', 'men', 'women', 'unisex'];

      let filteredPerfumes = allPerfumes;

      if (selectedCategory !== 'all') {
        filteredPerfumes = filteredPerfumes.filter(p => p.category.toLowerCase() === selectedCategory);
      }

      if (searchQuery.trim()) {
        const query = searchQuery.toLowerCase();
        filteredPerfumes = filteredPerfumes.filter(p =>
          p.name.toLowerCase().includes(query) ||
          p.brand.toLowerCase().includes(query) ||
          p.category.toLowerCase().includes(query)
        );
      }

      return `
        ${renderNav(storeName, surfaceColor, textColor, secondaryColor, baseFontSize)}
        
        <main class="w-full max-w-7xl mx-auto px-6 py-12">
          <div class="mb-8">
            <h1 class="mb-2" style="font-size: ${baseFontSize * 2.5}px; font-weight: 300; letter-spacing: 2px; color: ${textColor};">Our Collection</h1>
            <p style="font-size: ${baseFontSize}px; color: ${textColor}; opacity: 0.7;">${filteredPerfumes.length} fragrance${filteredPerfumes.length !== 1 ? 's' : ''} available</p>
          </div>
          
          <div class="mb-8 flex flex-wrap gap-4 items-center justify-between">
            <div class="flex gap-2">
              ${categories.map(cat => `
                <button 
                  class="filter-btn px-4 py-2 capitalize" 
                  data-category="${cat}"
                  style="background-color: ${selectedCategory === cat ? primaryColor : surfaceColor}; 
                         color: ${selectedCategory === cat ? 'white' : textColor}; 
                         font-size: ${baseFontSize * 0.9}px; 
                         border: 1px solid ${primaryColor};
                         cursor: pointer;"
                  onmouseover="if('${selectedCategory}' !== '${cat}') this.style.backgroundColor='${primaryColor}20'"
                  onmouseout="if('${selectedCategory}' !== '${cat}') this.style.backgroundColor='${surfaceColor}'"
                >
                  ${cat}
                </button>
              `).join('')}
            </div>
            
            <div class="flex gap-2">
              <input 
                type="text" 
                id="search-input" 
                placeholder="Search perfumes..." 
                value="${searchQuery}"
                class="px-4 py-2 border"
                style="background-color: ${surfaceColor}; 
                       color: ${textColor}; 
                       font-size: ${baseFontSize * 0.9}px; 
                       border-color: ${primaryColor}; 
                       width: 250px;"
              />
            </div>
          </div>
          
          ${filteredPerfumes.length > 0 ? `
            <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">
              ${filteredPerfumes.map(p => renderPerfumeCard(p, surfaceColor, textColor, primaryColor, baseFontSize)).join('')}
            </div>
          ` : `
            <div class="text-center py-16">
              <p style="font-size: ${baseFontSize * 1.25}px; color: ${textColor}; opacity: 0.7;">No perfumes found matching your criteria.</p>
              ${allPerfumes.length === 0 ? `
                <button onclick="navigateToView('admin')" class="mt-6 px-6 py-2 text-white" style="background-color: ${primaryColor}; font-size: ${baseFontSize}px; cursor: pointer;">
                  Add Your First Perfume
                </button>
              ` : ''}
            </div>
          `}
        </main>
        
        ${renderFooter(config, surfaceColor, textColor, primaryColor, baseFontSize)}
        ${selectedPerfume ? renderProductModal(selectedPerfume, config, surfaceColor, textColor, primaryColor, secondaryColor, baseFontSize) : ''}
      `;
    }


    function renderNav(storeName, surfaceColor, textColor, secondaryColor, baseFontSize) {
      return `
        <nav class="w-full px-6 py-4 sticky top-0 z-50" style="background-color: ${surfaceColor}; border-bottom: 1px solid ${secondaryColor}30; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
          <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2 cursor-pointer" onclick="navigateToView('home')">
              <span style="font-size: ${baseFontSize * 2}px; color: ${secondaryColor};">ðŸ’Ž</span>
              <h1 class="nav-link" style="font-size: ${baseFontSize * 1.5}px; font-weight: 300; letter-spacing: 2px; color: ${textColor};">${storeName}</h1>
            </div>
            <div class="flex gap-6">
              <button onclick="navigateToView('home')" class="nav-link" style="font-size: ${baseFontSize}px; color: ${textColor}; background: none; border: none; cursor: pointer;">Home</button>
              <button onclick="navigateToView('catalog')" class="nav-link" style="font-size: ${baseFontSize}px; color: ${textColor}; background: none; border: none; cursor: pointer;">Catalog</button>
              <button onclick="navigateToView('about')" class="nav-link" style="font-size: ${baseFontSize}px; color: ${textColor}; background: none; border: none; cursor: pointer;">About</button>
              <button onclick="navigateToView('contact')" class="nav-link" style="font-size: ${baseFontSize}px; color: ${textColor}; background: none; border: none; cursor: pointer;">Contact</button>
              <button onclick="navigateToView('admin')" class="nav-link" style="font-size: ${baseFontSize}px; color: ${secondaryColor}; background: none; border: none; cursor: pointer;">Admin</button>
            </div>
          </div>
        </nav>
      `;
    }

    function renderFooter(config, surfaceColor, textColor, primaryColor, baseFontSize) {
      const storeName = config.store_name || defaultConfig.store_name;
      const instagramHandle = config.instagram_handle || defaultConfig.instagram_handle;

      return `
        <footer class="w-full px-6 py-8 mt-16" style="background-color: ${surfaceColor}; border-top: 1px solid ${primaryColor}30;">
          <div class="max-w-7xl mx-auto text-center">
            <p class="mb-2" style="font-size: ${baseFontSize}px; color: ${textColor};">Â© 2024 ${storeName}. All rights reserved.</p>
            <p style="font-size: ${baseFontSize * 0.9}px; color: ${textColor}; opacity: 0.7;">Follow us ${instagramHandle}</p>
          </div>
        </footer>
      `;
    }

    function renderPerfumeCard(perfume, surfaceColor, textColor, primaryColor, baseFontSize) {
      return `
        <div class="hover-lift cursor-pointer fade-in" style="background-color: ${surfaceColor}; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" onclick="openProductModal('${perfume.__backendId}')">
          <div class="w-full flex items-center justify-center" style="height: 250px; background: linear-gradient(135deg, ${primaryColor}20 0%, ${primaryColor}10 100%);">
            <span style="font-size: ${baseFontSize * 4}px;">ðŸŽ¨</span>
          </div>
          <div class="p-4">
            <p class="mb-1" style="font-size: ${baseFontSize * 0.85}px; color: ${primaryColor}; text-transform: uppercase; letter-spacing: 1px;">${perfume.brand}</p>
            <h3 class="mb-2" style="font-size: ${baseFontSize * 1.1}px; font-weight: 600; color: ${textColor};">${perfume.name}</h3>
            <div class="flex justify-between items-center">
              <p style="font-size: ${baseFontSize * 1.25}px; font-weight: 600; color: ${textColor};">$${perfume.price}</p>
              <p style="font-size: ${baseFontSize * 0.85}px; color: ${textColor}; opacity: 0.7;">${perfume.size}</p>
            </div>
            ${!perfume.in_stock ? `<p class="mt-2" style="font-size: ${baseFontSize * 0.8}px; color: #ef4444;">Out of Stock</p>` : ''}
          </div>
        </div>
      `;
    }

    function renderProductModal(perfume, config, surfaceColor, textColor, primaryColor, secondaryColor, baseFontSize) {
      const whatsappNumber = config.whatsapp_number || defaultConfig.whatsapp_number;
      const whatsappMessage = encodeURIComponent(`Hi! I'm interested in ${perfume.name} by ${perfume.brand} ($${perfume.price})`);

      return `
        <div class="modal-backdrop fixed inset-0 flex items-center justify-center z-50 p-4" style="background: rgba(0,0,0,0.7);" onclick="closeProductModal()">
          <div class="w-full max-w-4xl max-h-full overflow-y-auto fade-in" style="background-color: ${surfaceColor}; border-radius: 12px; box-shadow: 0 20px 60px rgba(0,0,0,0.3);" onclick="event.stopPropagation()">
            <div class="grid md:grid-cols-2 gap-8 p-8">
              <div class="flex items-center justify-center" style="background: linear-gradient(135deg, ${primaryColor}20 0%, ${primaryColor}10 100%); border-radius: 8px; min-height: 400px;">
                <span style="font-size: ${baseFontSize * 8}px;">ðŸŽ¨</span>
              </div>
              
              <div class="flex flex-col justify-center">
                <p class="mb-2" style="font-size: ${baseFontSize * 0.9}px; color: ${primaryColor}; text-transform: uppercase; letter-spacing: 1px;">${perfume.brand}</p>
                <h2 class="mb-4" style="font-size: ${baseFontSize * 2}px; font-weight: 300; color: ${textColor};">${perfume.name}</h2>
                
                <div class="mb-4 flex items-center gap-4">
                  <p style="font-size: ${baseFontSize * 1.75}px; font-weight: 600; color: ${textColor};">$${perfume.price}</p>
                  <span class="px-3 py-1 capitalize" style="background-color: ${secondaryColor}20; color: ${secondaryColor}; font-size: ${baseFontSize * 0.85}px; border-radius: 20px;">${perfume.category}</span>
                </div>
                
                <p class="mb-2" style="font-size: ${baseFontSize}px; color: ${textColor}; opacity: 0.7;">Size: ${perfume.size}</p>
                <p class="mb-6" style="font-size: ${baseFontSize}px; color: ${textColor}; line-height: 1.7;">${perfume.description || 'A luxurious fragrance crafted with the finest ingredients.'}</p>
                
                ${perfume.in_stock ? `
                  <a 
                    href="https://wa.me/${whatsappNumber.replace(/[^0-9]/g, '')}?text=${whatsappMessage}" 
                    target="_blank" 
                    rel="noopener noreferrer"
                    class="w-full px-6 py-3 text-white text-center"
                    style="background-color: ${primaryColor}; font-size: ${baseFontSize * 1.1}px; text-decoration: none; display: block;"
                  >
                    <i class="fab fa-whatsapp mr-2"></i>Inquire via WhatsApp
                  </a>
                ` : `
                  <button 
                    disabled
                    class="w-full px-6 py-3 text-white"
                    style="background-color: #9ca3af; font-size: ${baseFontSize * 1.1}px; cursor: not-allowed; opacity: 0.7;"
                  >
                    Out of Stock
                  </button>
                `}
                
                <button 
                  onclick="closeProductModal()" 
                  class="mt-3 w-full px-6 py-3"
                  style="background-color: transparent; color: ${textColor}; font-size: ${baseFontSize}px; border: 1px solid ${textColor}; cursor: pointer;"
                >
                  Close
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function attachEventListeners(config, primaryColor, secondaryColor) {
      const categoryButtons = document.querySelectorAll('[data-category]');
      categoryButtons.forEach(btn => {
        btn.addEventListener('click', (e) => {
          selectedCategory = e.target.dataset.category;
          renderApp();
        });
      });

      const searchInput = document.getElementById('search-input');
      if (searchInput) {
        searchInput.addEventListener('input', (e) => {
          searchQuery = e.target.value;
          renderApp();
        });
      }
    }

    function navigateToView(view) {
      currentView = view;
      selectedPerfume = null;
      window.scrollTo(0, 0);
      renderApp();
    }

    function openProductModal(perfumeId) {
      selectedPerfume = allPerfumes.find(p => p.__backendId === perfumeId);
      renderApp();
    }

    function closeProductModal() {
      selectedPerfume = null;
      renderApp();
    }

    function openAddPerfumeModal() {
      const config = window.elementSdk?.config || defaultConfig;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
      const baseFontSize = config.font_size || defaultConfig.font_size;

      if (allPerfumes.length >= 999) {
        const modal = document.getElementById('perfume-modal');
        modal.innerHTML = `
          <div class="modal-backdrop fixed inset-0 flex items-center justify-center z-50 p-4" onclick="closeAddPerfumeModal()">
            <div class="w-full max-w-md p-8 text-center" style="background-color: ${surfaceColor}; border-radius: 12px;" onclick="event.stopPropagation()">
              <h3 class="mb-4" style="font-size: ${baseFontSize * 1.5}px; color: ${textColor};">Limit Reached</h3>
              <p class="mb-6" style="font-size: ${baseFontSize}px; color: ${textColor};">Maximum limit of 999 perfumes reached. Please delete some items first.</p>
              <button onclick="closeAddPerfumeModal()" class="px-6 py-2 text-white" style="background-color: ${primaryColor}; font-size: ${baseFontSize}px; cursor: pointer;">
                OK
              </button>
            </div>
          </div>
        `;
        return;
      }

      showPerfumeForm(null);
    }

    function editPerfume(perfumeId) {
      const perfume = allPerfumes.find(p => p.__backendId === perfumeId);
      showPerfumeForm(perfume);
    }

    function showPerfumeForm(perfume = null) {
      const config = window.elementSdk?.config || defaultConfig;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
      const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;
      const baseFontSize = config.font_size || defaultConfig.font_size;

      const isEdit = perfume !== null;
      const modal = document.getElementById('perfume-modal');

      modal.innerHTML = `
        <div class="modal-backdrop fixed inset-0 flex items-center justify-center z-50 p-4" onclick="closeAddPerfumeModal()">
          <div class="w-full max-w-2xl max-h-full overflow-y-auto" style="background-color: ${surfaceColor}; border-radius: 12px; padding: 32px;" onclick="event.stopPropagation()">
            <h2 class="mb-6" style="font-size: ${baseFontSize * 1.75}px; font-weight: 300; color: ${textColor};">${isEdit ? 'Edit' : 'Add'} Perfume</h2>
            
            <form id="perfume-form" class="space-y-4">
              <div>
                <label for="name" style="font-size: ${baseFontSize * 0.9}px; color: ${textColor}; display: block; margin-bottom: 4px;">Name</label>
                <input 
                  type="text" 
                  id="name" 
                  required 
                  value="${perfume?.name || ''}"
                  class="w-full px-4 py-2 border"
                  style="background-color: white; color: ${textColor}; font-size: ${baseFontSize}px; border-color: ${primaryColor}40;"
                />
              </div>
              
              <div>
                <label for="brand" style="font-size: ${baseFontSize * 0.9}px; color: ${textColor}; display: block; margin-bottom: 4px;">Brand</label>
                <input 
                  type="text" 
                  id="brand" 
                  required 
                  value="${perfume?.brand || ''}"
                  class="w-full px-4 py-2 border"
                  style="background-color: white; color: ${textColor}; font-size: ${baseFontSize}px; border-color: ${primaryColor}40;"
                />
              </div>
              
              <div>
                <label for="category" style="font-size: ${baseFontSize * 0.9}px; color: ${textColor}; display: block; margin-bottom: 4px;">Category</label>
                <select 
                  id="category" 
                  required
                  class="w-full px-4 py-2 border"
                  style="background-color: white; color: ${textColor}; font-size: ${baseFontSize}px; border-color: ${primaryColor}40;"
                >
                  <option value="men" ${perfume?.category === 'men' ? 'selected' : ''}>Men</option>
                  <option value="women" ${perfume?.category === 'women' ? 'selected' : ''}>Women</option>
                  <option value="unisex" ${perfume?.category === 'unisex' ? 'selected' : ''}>Unisex</option>
                </select>
              </div>
              
              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label for="price" style="font-size: ${baseFontSize * 0.9}px; color: ${textColor}; display: block; margin-bottom: 4px;">Price ($)</label>
                  <input 
                    type="number" 
                    id="price" 
                    required 
                    step="0.01"
                    value="${perfume?.price || ''}"
                    class="w-full px-4 py-2 border"
                    style="background-color: white; color: ${textColor}; font-size: ${baseFontSize}px; border-color: ${primaryColor}40;"
                  />
                </div>
                
                <div>
                  <label for="size" style="font-size: ${baseFontSize * 0.9}px; color: ${textColor}; display: block; margin-bottom: 4px;">Size</label>
                  <input 
                    type="text" 
                    id="size" 
                    required 
                    placeholder="e.g., 50ml"
                    value="${perfume?.size || ''}"
                    class="w-full px-4 py-2 border"
                    style="background-color: white; color: ${textColor}; font-size: ${baseFontSize}px; border-color: ${primaryColor}40;"
                  />
                </div>
              </div>
              
              <div>
                <label for="description" style="font-size: ${baseFontSize * 0.9}px; color: ${textColor}; display: block; margin-bottom: 4px;">Description</label>
                <textarea 
                  id="description" 
                  rows="3"
                  class="w-full px-4 py-2 border"
                  style="background-color: white; color: ${textColor}; font-size: ${baseFontSize}px; border-color: ${primaryColor}40;"
                >${perfume?.description || ''}</textarea>
              </div>
              
              <div>
                <label for="image_url" style="font-size: ${baseFontSize * 0.9}px; color: ${textColor}; display: block; margin-bottom: 4px;">Image URL (optional)</label>
                <input 
                  type="url" 
                  id="image_url" 
                  placeholder="https://..."
                  value="${perfume?.image_url || ''}"
                  class="w-full px-4 py-2 border"
                  style="background-color: white; color: ${textColor}; font-size: ${baseFontSize}px; border-color: ${primaryColor}40;"
                />
              </div>
              
              <div class="flex items-center gap-4">
                <label class="flex items-center gap-2" style="cursor: pointer;">
                  <input 
                    type="checkbox" 
                    id="in_stock" 
                    ${perfume?.in_stock !== false ? 'checked' : ''}
                    style="width: 18px; height: 18px; cursor: pointer;"
                  />
                  <span style="font-size: ${baseFontSize * 0.9}px; color: ${textColor};">In Stock</span>
                </label>
                
                <label class="flex items-center gap-2" style="cursor: pointer;">
                  <input 
                    type="checkbox" 
                    id="featured" 
                    ${perfume?.featured ? 'checked' : ''}
                    style="width: 18px; height: 18px; cursor: pointer;"
                  />
                  <span style="font-size: ${baseFontSize * 0.9}px; color: ${textColor};">Featured</span>
                </label>
              </div>
              
              <div class="flex gap-3 pt-4">
                <button 
                  type="submit" 
                  id="submit-btn"
                  class="flex-1 px-6 py-3 text-white"
                  style="background-color: ${primaryColor}; font-size: ${baseFontSize}px; cursor: pointer;"
                >
                  ${isEdit ? 'Update' : 'Add'} Perfume
                </button>
                <button 
                  type="button" 
                  onclick="closeAddPerfumeModal()"
                  class="px-6 py-3"
                  style="background-color: transparent; color: ${textColor}; font-size: ${baseFontSize}px; border: 1px solid ${textColor}; cursor: pointer;"
                >
                  Cancel
                </button>
              </div>
            </form>
          </div>
        </div>
      `;

      const form = document.getElementById('perfume-form');
      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const submitBtn = document.getElementById('submit-btn');
        submitBtn.disabled = true;
        submitBtn.textContent = isEdit ? 'Updating...' : 'Adding...';

        const formData = {
          id: perfume?.id || Date.now().toString(),
          name: document.getElementById('name').value,
          brand: document.getElementById('brand').value,
          category: document.getElementById('category').value,
          price: parseFloat(document.getElementById('price').value),
          size: document.getElementById('size').value,
          description: document.getElementById('description').value,
          image_url: document.getElementById('image_url').value,
          in_stock: document.getElementById('in_stock').checked,
          featured: document.getElementById('featured').checked,
          created_at: perfume?.created_at || new Date().toISOString()
        };

        let result;
        if (isEdit) {
          result = await window.dataSdk.update({ ...formData, __backendId: perfume.__backendId });
        } else {
          result = await window.dataSdk.create(formData);
        }

        if (result.isOk) {
          closeAddPerfumeModal();
        } else {
          submitBtn.disabled = false;
          submitBtn.textContent = isEdit ? 'Update Perfume' : 'Add Perfume';
          const modal = document.getElementById('perfume-modal');
          const errorDiv = document.createElement('div');
          errorDiv.className = 'mt-4 p-3';
          errorDiv.style.backgroundColor = '#fee2e2';
          errorDiv.style.color = '#dc2626';
          errorDiv.style.borderRadius = '4px';
          errorDiv.textContent = 'Failed to save perfume. Please try again.';
          form.appendChild(errorDiv);
        }
      });
    }

    async function deletePerfume(perfumeId) {
      const perfume = allPerfumes.find(p => p.__backendId === perfumeId);
      const config = window.elementSdk?.config || defaultConfig;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
      const baseFontSize = config.font_size || defaultConfig.font_size;

      const modal = document.getElementById('perfume-modal');
      modal.innerHTML = `
        <div class="modal-backdrop fixed inset-0 flex items-center justify-center z-50 p-4" onclick="closeAddPerfumeModal()">
          <div class="w-full max-w-md p-8" style="background-color: ${surfaceColor}; border-radius: 12px;" onclick="event.stopPropagation()">
            <h3 class="mb-4" style="font-size: ${baseFontSize * 1.5}px; color: ${textColor};">Confirm Delete</h3>
            <p class="mb-6" style="font-size: ${baseFontSize}px; color: ${textColor};">Are you sure you want to delete "${perfume.name}"?</p>
            <div class="flex gap-3">
              <button 
                id="confirm-delete"
                class="flex-1 px-6 py-2 text-white"
                style="background-color: #ef4444; font-size: ${baseFontSize}px; cursor: pointer;"
              >
                Delete
              </button>
              <button 
                onclick="closeAddPerfumeModal()"
                class="flex-1 px-6 py-2"
                style="background-color: transparent; color: ${textColor}; font-size: ${baseFontSize}px; border: 1px solid ${textColor}; cursor: pointer;"
              >
                Cancel
              </button>
            </div>
          </div>
        </div>
      `;

      document.getElementById('confirm-delete').addEventListener('click', async () => {
        const btn = document.getElementById('confirm-delete');
        btn.disabled = true;
        btn.textContent = 'Deleting...';

        const result = await window.dataSdk.delete(perfume);

        if (result.isOk) {
          closeAddPerfumeModal();
        } else {
          btn.disabled = false;
          btn.textContent = 'Delete';
          const errorDiv = document.createElement('div');
          errorDiv.className = 'mt-4 p-3';
          errorDiv.style.backgroundColor = '#fee2e2';
          errorDiv.style.color = '#dc2626';
          errorDiv.style.borderRadius = '4px';
          errorDiv.textContent = 'Failed to delete perfume. Please try again.';
          modal.querySelector('div > div').appendChild(errorDiv);
        }
      });
    }

    function closeAddPerfumeModal() {
      const modal = document.getElementById('perfume-modal');
      if (modal) modal.innerHTML = '';
    }

    window.navigateToView = navigateToView;
    window.openProductModal = openProductModal;
    window.closeProductModal = closeProductModal;
    window.openAddPerfumeModal = openAddPerfumeModal;
    window.editPerfume = editPerfume;
    window.deletePerfume = deletePerfume;
    window.closeAddPerfumeModal = closeAddPerfumeModal;

    initializeApp();
  </script>
  <script>(function () { function c() { var b = a.contentDocument || a.contentWindow.document; if (b) { var d = b.createElement('script'); d.innerHTML = "window.__CF$cv$params={r:'9a3ff52657fae309',t:'MTc2NDA2MTI0Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);"; b.getElementsByTagName('head')[0].appendChild(d) } } if (document.body) { var a = document.createElement('iframe'); a.height = 1; a.width = 1; a.style.position = 'absolute'; a.style.top = 0; a.style.left = 0; a.style.border = 'none'; a.style.visibility = 'hidden'; document.body.appendChild(a); if ('loading' !== document.readyState) c(); else if (window.addEventListener) document.addEventListener('DOMContentLoaded', c); else { var e = document.onreadystatechange || function () { }; document.onreadystatechange = function (b) { e(b); 'loading' !== document.readyState && (document.onreadystatechange = e, c()) } } } })();</script>
</body>

</html>